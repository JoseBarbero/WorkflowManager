\chapter{Introducción} 
\label{chap:intro}

\vspace{-0.2cm}

\section{Motivación del proyecto}

\textit{Campylobacter jejuni} es una bacteria Gram negativa que, a pesar de tener unas condiciones complicadas de crecimiento~\cite{garciasanchez2017}, es la zoonosis bacteriana que produce un mayor número de intoxicaciones alimentarias en los países tanto desarrollados como en vías de desarrollo. Por ejemplo, en la EU en el año 2016 se declararon del orden de 250.000 casos comprobados~\cite{report2016}. El coste debido a la campilobacteriosis se estima en la EU en torno a 2,4 billones de euros anuales. La fuente de contaminación más habitual es el consumo de carne de pollo poco cocinada~\cite{GarciaSanchez2018}. El grupo de investigación Tecnofood\footnote{\url{https://www.ubu.es/tecnologia-de-los-alimentos-tecnofood}} lleva varios años investigando sobre las fuentes de contaminación de este microorganismo a lo largo de la cadena alimentaria~\cite{garciasanchez2017, GarciaSanchez2018, Melero2012}. En la actualidad se dispone de una colección de \textit{Campylobacter} spp. de alrededor de 2000 cepas. Con el fin de obtener una información más precisa sobre la persistencia de este microorganismo a lo largo de la cadena alimentaria, se han aislado varios genotipos persistentes en el matadero. De estos, se han secuenciado 46 con un equipo \textit{HiSeq} de (\textit{Illumina}).

El proyecto consiste en diseñar un workflow que permita, a partir de los datos proporcionados por el equipo en formato \textit{fastq}, conseguir realizar las fases filtrado de calidad, ensamblado y anotación, para poder tener la información de la secuencia de genes del genoma completo~\cite{Clark2016, Llarena2017, Zhao2016} de las cepas de \textit{Campylobacter jejuni} secuenciadas. En la actualidad, existen diferentes programas desarrollados por varios grupos de investigación internacional que se encargan de coordinar cada una de las tareas mencionadas, además de la relación de los datos de salida de unas herramientas con los de entrada de otras. Se trata de buscar la solución más eficaz y fácil de implementar y que dé los mejores resultados, utilizando preferiblemente una serie de herramientas estudiadas previamente. Adicionalmente, se requiere incorporar en este workflow, o en análisis paralelos, la posibilidad de detectar insertos de origen viral y/o plásmidos en el genoma y herramientas que permitan la comparación rápida de los genomas de las distintas cepas aisladas, algunas de ellas pertenecientes a cepas altamente clonales~\cite{Skarp2015}, así como un estudio de la resistencia a antibióticos. Esta herramienta se ha demandado por parte de un grupo sin conocimientos informáticos, por lo que se requiere desarrollar un entorno de fácil uso por su parte.

El proyecto plantea una colaboración entre los grupos ADMIRABLE \footnote{\url{https://www.ubu.es/advanced-data-mining-research-and-bioinformatics-learning-admirable}} y Tecnofood de la Universidad de Burgos, especializados en informática y ciencia y tecnología de los alimentos respectivamente. Dada esta combinación de disciplinas, el proyecto se encuentra en el marco de los trabajos considerados dentro del campo de la bioinformática.


\section{Objetivos y enfoque}
El objetivo principal del proyecto es el desarrollo de un workflow que permita el análisis genómico de cepas de \textit{Campylobacter jejuni}. Para ello, el primero de los objetivos es la utilización de la herramienta \textit{Galaxy}~\cite{afgan2018galaxy}, que permite realizar análisis computacionales de datos biológicos, y las herramientas disponibles en la <<tool shed>> (conjunto de herramientas que ofrece \textit{Galaxy} para su instalación).
El segundo objetivo se centra en crear una herramienta de utilización simplificada del workflow, en la que los pasos para su ejecución se configuren automáticamente, y que se llevará a cabo utilizando \textit{Python} y la API de \textit{Galaxy} a través de Bioblend~\cite{Sloggett2013}. 
Además, para facilitar el despliegue y ejecución de la herramienta desarrollada, se va a crear un contenedor \textit{Docker}. Por lo tanto, el siguiente objetivo parcial será desarrollar la imagen \textit{Docker} que sirva de base.
Finalmente, se desea que el usuario pueda tratar de forma sencilla los datos de salida, por lo que dentro de la interfaz gráfica se incluirán herramientas con las que gestionar toda la información resultante en forma de gráficos, tablas tipo hoja de cálculo, formatos \textit{pdf}, etc.

Objetivos parciales del proyecto:
\begin{itemize}
\item Crear un sistema \textit{Docker} sobre el que desplegar el proyecto.
\item Desarrollar el workflow necesario para el análisis de las cepas en \textit{Galaxy}.
\item Desarrollar una capa de utilización simplificada del workflow.
\item Añadir un sistema de gestión sencilla de los datos de salida.
\end{itemize}

En la tabla~\ref{table:HorasPlanDeTrabajo} se muestra un despliegue con la planificación temporal de cada uno de estos objetivos.

\section{Metodología y plan de trabajo}
\subsection{Metodología}
La metodología utilizada en el desarrollo del proyecto, dada su cercanía en su estructura a un proyecto de software tradicional, será de tipo ágil, basada en reuniones en cada sprint.
La carga de trabajo, como aproximación a falta de conocer ciertos requisitos que puedan surgir durante el desarrollo, se dividirá en la estructura definida en la estimación en horas del plan de trabajo.

\subsection{Plan de Trabajo}

\begin{table}[!h]

\begin{center}
\begin{tabularx}{\textwidth}{bs}
\arrayrulecolor{NavyBlue}\hline
\multicolumn{2}{l}{%
\textbf{\textcolor{NavyBlue}{Tarea 1 - Desarrollo de la imagen \textit{Docker} }}}\\
\quad Tarea 1.1 -  Adaptar la imagen previa orientada a \textit{Galaxy} &
\begin{minipage}[t]{\linewidth}%
50 horas
\end{minipage}\\

\quad Tarea 1.2 - Permitir desplegar la imagen en un servidor &
\begin{minipage}[t]{\linewidth}%
10 horas
\end{minipage}\\

\arrayrulecolor{NavyBlue}\hline
\multicolumn{2}{l}{%
\textbf{\textcolor{NavyBlue}{Tarea 2 - Desarrollo del workflow en \textit{Galaxy}}}} \\
\quad Tarea 2.1 - Selección de las herramientas &
\begin{minipage}[t]{\linewidth}%
30 horas
\end{minipage}\\

\quad Tarea 2.2 - Configuración completa del workflow  &
\begin{minipage}[t]{\linewidth}%
100 horas
\end{minipage}\\


\arrayrulecolor{NavyBlue}\hline
\multicolumn{2}{l}{%
\textbf{\textcolor{NavyBlue}{Tarea 3 - Desarrollo del modo de uso simplificado}}}\\
&
\begin{minipage}[t]{\linewidth}%
60 horas
\end{minipage}\\

\arrayrulecolor{NavyBlue}\hline
\multicolumn{2}{l}{%
\textbf{\textcolor{NavyBlue}{Tarea 4 - Desarrollo del sistema de tratamiento de datos de salida}}}\\
&
\begin{minipage}[t]{\linewidth}%
50 horas
\end{minipage}\\
\hline


\end{tabularx}
\end{center}
\caption{Estimación en horas del plan de trabajo}
\label{table:HorasPlanDeTrabajo}
\end{table}


\subsubsection{Sprint 1 (18/9/2018 - 3/10/2018)}
El primer sprint ha estado centrado tanto en definir con más exactitud la dirección del proyecto como en un primer acercamiento a las principales herramientas con las que va a desarrollarse. 

Tras unos primeros pasos con \textit{Galaxy}~\cite{Galaxy} y \textit{Docker}~\cite{Docker}, se ha tomado como referencia el trabajo Bioinfworkflow de Sergio Chico~\cite{Chico2018} como base para la imagen \textit{Docker} del proyecto. Dado que el proyecto de Github daba algunos problemas en la instalación, se ha desarrollado un script propio que produce los mismos resultados.

Una vez se ha tenido disponible la imagen de \textit{Docker}, el sprint se ha centrado en algunos aspectos importantes para partes futuras del desarrollo. Entre ellos destaca la investigación acerca del formato de los workflows de \textit{Galaxy} (.ga) ya que en un futuro será necesario generar este tipo de ficheros para introducirlos en \textit{Galaxy}. También resulta relevante la investigación acerca de las posibilidades que ofrece la API de \textit{Galaxy}~\cite{Galaxy} y su utilidad en Bioblend~\cite{GalaxyAPI}, que nos facilitan la opción de utilizar \textit{Galaxy} sin necesidad de hacerlo a través de su interfaz.

\subsubsection{Sprint 2 (4/10/2018 - 17/10/2018)}
La primera semana de este sprint ha estado dirigida a lograr una imagen \textit{Docker} de \textit{Galaxy} que contenga un set de herramientas básicas para formar un primer workflow. Se han valorado varias opciones de instalación en las que se han utilizado tanto la imagen básica de \textit{Galaxy}~\cite{GalaxyDocker} como la imagen de Bioinfworkflow~\cite{Chico2018}. Finalmente, se ha optado por utilizar Bioinforworkflow ya que parte de las herramientas necesarias ya estaban incluidas. 
Para realizar esta tarea se ha creado un nuevo fichero \textit{Dockerfile} así como el listado de herramientas necesarias para su instalación.

\subsubsection{Sprint 3 (18/10/2018 - 31/10/2018)}
El sprint ha estado centrado en la correcta ejecución del workflow con las herramientas iniciales desde \textit{Galaxy}. Durante el proceso de configuración, han surgido varias complicaciones que han impedido terminar el workflow completo en este sprint. 
En un principio, han surgido problemas con el filtrado de calidad utilizando \textit{Prinseq}. Este problema no ha llegado a ser resuelto en este sprint a falta de tratar el tema con el grupo de Tecnofood.
A continuación, se encontraron ciertos problemas con el formato de salida de la herramienta \textit{Prokka}. A pesar de que la salida está marcada como formato \textit{gff3}, un parámetro interno lo etiquetaba como \textit{gff}. Esto impedía que la salida de \textit{Prokka} pudiese ser utilizada como entrada en las herramientas siguientes.

Dados estos errores, se decidió trabajar en paralelo con la API de \textit{Galaxy} desde \textit{Python}, para intentar ejecutar tanto las herramientas como el workflow de una manera menos restringida. Finalmente, se ha llevado a cabo el desarrollo necesario para subir los ficheros a un historial y ejecutar cada una de las herramientas del workflow desde \textit{Python}.

\subsubsection{Sprint 4 (1/11/2018 - 14/11/2018)}
La prioridad en este punto se ha centrado en completar el workflow desde \textit{Galaxy}. Han surgido varios problemas en esta tarea. La primera es un bug en Mac por el cual los archivos eliminados dentro de \textit{Docker} no se eliminan del todo y quedan fijados en un fichero residual. Quizá esto pueda deberse a que \textit{OSX} no soporta de manera nativa la virtualización a nivel de sistema operativo, sino que se basa en \textit{Hyperkit} para crear una capa de virtualización. Esto implica que cada cierto tiempo hay que eliminar la imagen completa de \textit{Docker} para poder liberar espacio, dado el gran tamaño de los archivos con los que se trabaja. Debido a ello, la tarea de completar el workflow se ha visto retrasada. Además, la ejecución de la herramienta \textit{Roary} a través de \textit{Galaxy} ejecuta sin errores pero no devuelve ningún resultado, lo que ha impedido continuar con la parte final del workflow. 

Además de la tarea ya comentada, en este sprint se ha trabajado en el acceso al contenedor \textit{Docker} desde otro ordenador en una red local. Con el objetivo de desplegar el servicio en un servidor.

También se ha estudiado la posibilidad de desarrollar una interfaz gráfica, realizando unas pruebas en las que simplemente se muestra alguna información extraída de la API de \textit{Galaxy} en etiquetas creadas con \textit{PyQt}.

\subsubsection{Sprint 5 (15/11/2018 - 28/11/2018)}
Al igual que en los sprints anteriores, gran parte de la carga de trabajo se ha centrado en resolver problemas en la ejecución del workflow a través de \textit{Galaxy}. Se han realizado numerosas ejecuciones para comprobar si las salidas de cada herramienta eran las correctas. Esto ha servido para concluir que, al parecer, un fallo en la herramienta \textit{Roary} incluida en \textit{Galaxy}, impide que los ficheros retornados tengan contenido. Esto se ha comprobado a través de la ejecución de \textit{Roary} standalone con los mismos datos de entrada y los mismos parámetros, obteniendo de esta manera los ficheros correctos.

Para ahorrar en tiempos de ejecución se han utilizado los ficheros fasta ya generados previamente, no los generados con la herramienta \textit{Spades} de nuestro propio workflow. En el próximo sprint se tratará de integrar la parte previa a los pasos que ya son correctos.

También se ha añadido un fichero .\textit{gitignore} para evitar la existencia de ficheros irrelevantes en el repositorio.

Parte del trabajo de este sprint se ha destinado a la redacción de la propuesta de proyecto y de la introducción a la documentación del mismo.

\subsubsection{Sprint 6 (29/11/2018 - 12/12/2018)}
El trabajo de este sprint se ha centrado en fragmentar el proceso del workflow lo máximo posible para detectar dónde se están produciendo los errores.
Inicialmente se ha acortado el workflow hasta el paso de ensamblaje con \textit{Spades}, ya que los problemas surgían en este punto. Posteriormente se ha ejecutado el workflow individualmente en lugar de por colecciones. De esta manera, se ha detectado que el problema se está dando en la ejecución de \textit{Spades} con dos secuencias concretas: 590 y 443. Tras investigar probando varias ejecuciones con diferentes parámetros, se ha llegado a la conclusión de que no era un fallo de configuración de la herramienta, sino de hardware. Al ceder a \textit{Docker} una cantidad mayor de memoria RAM (8 Gb), el problema se ha solucionado. 
A continuación, se ha pasado a ejecutar de nuevo por colecciones hasta el paso de \textit{Spades}, para comprobar si con este cambio ha sido suficiente para que la ejecución sea correcta con este formato. 

También se ha realizado una modificación del fichero .\textit{gitignore} para mantener los archivos .\textit{pdf} generados por \LaTeX.

\subsubsection{Sprint 7 (13/12/2018 - 26/12/2018)}
La tarea principal de este sprint ha sido la creación de una herramienta \textit{Roary} que poder integrar en \textit{Galaxy}. Se valoró la opción de crear una nueva imagen \textit{Galaxy} instalando la herramienta desde la creación inicial de \textit{Docker}, pero finalmente se ha optado por subir esta versión de \textit{Roary} al \emph{tool shed} de \textit{Galaxy}.

A continuación, se han realizado varias comprobaciones del funcionamiento de la integración de esta herramienta, con resultados positivos. Sin embargo, al ejecutar el workflow completo, parecen surgir de nuevo errores en la parte de \textit{Prokka}, provocados por la ejecución previa de \textit{Spades}. 

También se ha añadido el apartado de la Introducción de la documentación.

\subsubsection{Sprint 8 (27/12/2018 - 9/1/2019)}
El trabajo en este sprint se ha enfocado a completar definitivamente la ejecución del workflow solucionando los errores existentes. La máquina virtual con la que se realizaban estas pruebas disponía de 4 GB de RAM, insuficiente para la ejecución con este conjunto de datos. Esto causaba algunos errores poco descriptivos al ejecutarlo. El equipo de pruebas se ha aumentado a 32 GB de RAM, cediendo 16 GB a la máquina virtual, solucionando así estos errores.

A continuación, se ha desarrollado un script \textit{Python} a partir del cual realizar todas las tareas necesarias para ejecutar el workflow, utilizando la API de \textit{Galaxy}.

Se ha invertido el poco tiempo restante del sprint en el desarrollo de la documentación, definiendo la estructura de los apartados de <<estado del arte>> y <<sistema, diseño y desarrollo>>.

\subsubsection{Sprint 9 (10/1/2019 - 23/1/2019)}
En este sprint se ha buscado cerrar los últimos detalles del sistema de ejecución del workflow. Uno de los aspectos relevantes era evitar la instalación de \textit{Python} y sus dependencias al usuario. Para conseguirlo, se ha utilizado la utilidad \textit{Pyinstaller}, con la que se han generado ejecutables que no requieren de \textit{Python} y funcionan por sí mismos. 

Una vez lista la fase de programación, gran parte del tiempo se va a centrar en la documentación de la memoria. En este caso, se ha redactado el capítulo 3: <<Sistema, diseño y desarrollo>>.

\subsubsection{Sprint 10 (24/1/2019 - 6/2/2019)}
Este sprint ha estado muy centrado en la documentación y en él se han redactado los capítulos <<Estado del arte>>, <<Manual de utilización>> y <<Manual del programador>>.

Respecto a la programación, se han terminado algunas funcionalidades pendientes, como la creación del \textit{.xls} único con los resultados o funcionalidades relativas a los ficheros generados por \textit{Galaxy}.


\subsubsection{Sprint 11 (7/2/2019 - 15/2/2019)}
El último sprint se ha dedicado a terminar los capítulos pendientes <<Experimentos realizados>>, <<Resumen>> y <<Conclusiones y trabajo futuro>>. También se ha resuelto un bug por el cual, al cargar una cantidad mucho mayor de datos, los procesos de \textit{Galaxy} no se limitaban y el procesador no soportaba la ejecución.